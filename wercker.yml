box: debian:sid

build:
    steps:
        - install-packages:
          packages: "hugo"
        - script:
          name: "Run hugo"
          command: hugo --source=${WERCKER_SOURCE_DIR} -d public
deploy:
    box: google/cloud-sdk
    steps:
        - script:
            name: activate service account
            code: |
                echo $GCS_KEY_JSON >> secret.json
                CLOUDSDK_PYTHON_SITEPACKAGES=1 gcloud auth activate-service-account $GCS_CLIENT_MAIL --key-file secret.json
        - script:
            name: upload to gs
            code: |
                # Sync
                gsutil -m rsync -r -d public gs://$GCS_BUCKET
                # Create gz files
                gsutil -m cp -r -z html,css,js,xml,txt,json,map,svg public/* gs://$GCS_BUCKET
