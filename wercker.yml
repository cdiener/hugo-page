box: debian:testing

build:
    steps:
        - arjen/hugo-build:
          version: "0.17"
          disable_pygments: true
deploy:
    box: google/cloud-sdk
    steps:
        - script:
            name: activate service account
            code: |
                echo $GCS_KEY_JSON >> secret.json
                CLOUDSDK_PYTHON_SITEPACKAGES=1 gcloud auth activate-service-account $GCS_CLIENT_MAIL --key-file secret.json
        - script:
            name: upload to gs
            code: |
                # Sync
                gsutil -m rsync -r -d public gs://$GCS_BUCKET
                # Create gz files
                gsutil -m cp -r -z html,css,js,xml,txt,json,map,svg public/* gs://$GCS_BUCKET
